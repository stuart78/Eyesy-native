<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EYESY Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header class="top-bar">
            <h1>EYESY Simulator</h1>
            <nav class="top-nav">
                <a href="#about">About</a>
                <a href="#" id="helpLink">Help</a>
            </nav>
        </header>

        <div class="layout">
            <div class="panel controls-panel" id="controlsPanel">
                <h2>
                    <span>Controls</span>
                    <button class="collapse-btn" id="collapseBtn" title="Collapse panel">−</button>
                </h2>

                <div class="panel-content" id="panelContent">
                    <div class="mode-selector">
                        <label for="modeSelect">Mode:</label>
                        <select id="modeSelect">
                            <option value="">Select a mode...</option>
                        </select>
                        <button id="loadModeBtn">Load Mode</button>
                    </div>

                    <div class="file-selector">
                        <label for="fileInput">Or load from file:</label>
                        <input type="file" id="fileInput" accept=".py" style="display: none;">
                        <button id="browseFileBtn">Browse main.py</button>
                        <span id="selectedFile" class="selected-file">No file selected</span>
                        <button id="loadFileBtn" disabled>Load File</button>
                    </div>

                    <div class="buttons">
                        <button id="startBtn">Start</button>
                        <button id="stopBtn" disabled>Stop</button>
                        <button id="refreshModesBtn">Refresh Modes</button>
                    </div>

                    <div class="audio-controls">
                        <h3>
                            <span>Audio</span>
                            <button id="audioPlayPauseBtn" class="audio-play-btn" title="Play audio">&#9654;</button>
                        </h3>
                        <div class="audio-row">
                            <label for="audioType">Type:</label>
                            <select id="audioType">
                                <option value="silence">Silence</option>
                                <option value="sine">Sine Wave</option>
                                <option value="noise">White Noise</option>
                                <option value="beat">Beat/Kick</option>
                                <option value="file">Audio File</option>
                                <option value="stream">Internet Radio</option>
                            </select>
                        </div>
                        <div class="audio-row audio-file-row" id="audioFileRow" style="display: none;">
                            <label for="audioFileInput">File:</label>
                            <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                            <button type="button" id="browseAudioBtn" class="browse-btn">Browse...</button>
                            <span id="audioFileName" class="audio-file-name">No file selected</span>
                        </div>
                        <div class="audio-row audio-stream-row" id="audioStreamRow" style="display: none;">
                            <label for="audioStreamPreset">Station:</label>
                            <select id="audioStreamPreset">
                                <option value="">Custom URL...</option>
                                <option value="https://ice1.somafm.com/dronezone-128-mp3">SomaFM: Drone Zone</option>
                                <option value="https://ice1.somafm.com/deepspaceone-128-mp3">SomaFM: Deep Space One</option>
                                <option value="https://ice1.somafm.com/groovesalad-128-mp3">SomaFM: Groove Salad</option>
                                <option value="https://ice1.somafm.com/defcon-128-mp3">SomaFM: DEF CON Radio</option>
                                <option value="https://ice1.somafm.com/thetrip-128-mp3">SomaFM: The Trip</option>
                                <option value="https://ice1.somafm.com/cliqhop-128-mp3">SomaFM: cliqhop idm</option>
                            </select>
                        </div>
                        <div class="audio-row audio-stream-url-row" id="audioStreamUrlRow" style="display: none;">
                            <label for="audioStreamUrl">URL:</label>
                            <input type="text" id="audioStreamUrl" placeholder="https://stream.example.com/radio.mp3">
                        </div>
                        <div class="audio-row">
                            <label for="audioLevel">Level:</label>
                            <input type="range" id="audioLevel" min="0" max="100" value="100">
                            <span id="audioLevelValue">1.00</span>
                        </div>
                        <div class="audio-row">
                            <label for="audioFreq">Frequency:</label>
                            <input type="range" id="audioFreq" min="20" max="2000" value="440">
                            <span id="audioFreqValue">440 Hz</span>
                        </div>
                        <div class="audio-row audio-toggle">
                            <label for="playAudioToggle">Play in browser:</label>
                            <input type="checkbox" id="playAudioToggle" checked>
                            <span class="toggle-hint">Hear the audio in browser</span>
                        </div>
                        <div class="audio-row">
                            <label></label>
                            <button id="applyAudioBtn">Apply Audio Settings</button>
                        </div>
                    </div>

                    <div id="status">Connecting to server...</div>

                    <div class="info">
                        <strong>Eyesy Python Simulator</strong><br>
                        Running actual Python scripts on the backend with pygame compatibility.<br>
                        Canvas: 1280x720 | Target FPS: 30
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Preview</h2>
                <canvas id="canvas" width="1280" height="720"></canvas>

                <div class="stats">
                    <span id="fps">FPS: --</span>
                    <span id="connection">●</span>
                </div>
                <div class="preview-size">
                    <span>Preview Canvas: </span><span id="previewSize">--x--</span>
                </div>

                <div class="controls knob-controls">
                    <div class="knob-control">
                        <label>Knob 1</label>
                        <input type="range" id="knob1" min="0" max="100" value="50">
                        <div class="value">0.50</div>
                    </div>
                    <div class="knob-control">
                        <label>Knob 2</label>
                        <input type="range" id="knob2" min="0" max="100" value="50">
                        <div class="value">0.50</div>
                    </div>
                    <div class="knob-control">
                        <label>Knob 3</label>
                        <input type="range" id="knob3" min="0" max="100" value="50">
                        <div class="value">0.50</div>
                    </div>
                    <div class="knob-control">
                        <label>Knob 4</label>
                        <input type="range" id="knob4" min="0" max="100" value="50">
                        <div class="value">0.50</div>
                    </div>
                    <div class="knob-control">
                        <label>Knob 5</label>
                        <input type="range" id="knob5" min="0" max="100" value="50">
                        <div class="value">0.50</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Panel -->
    <div class="about-panel" id="aboutPanel">
        <div class="about-header">
            <h2>About</h2>
            <button class="about-close-btn" id="aboutCloseBtn">&times;</button>
        </div>
        <div class="about-content">
            <h3>EYESY Simulator</h3>
            <p>A web-based simulator for the <a href="https://www.critterandguitari.com/eyesy" target="_blank" rel="noopener">Critter &amp; Guitari EYESY</a> video synthesizer.</p>
            <p>Develop and test EYESY modes without the physical hardware. Run actual Python scripts locally with real-time visualization.</p>

            <h3>Author</h3>
            <p>Created by Stuart Frederich-Smith<br>
            <a href="https://signalfunctionset.com" target="_blank" rel="noopener">signalfunctionset.com</a></p>

            <h3>License</h3>
            <p>&copy; 2025 Stuart Frederich-Smith. All rights reserved.</p>
        </div>
    </div>

    <!-- Help Panel -->
    <div class="help-panel" id="helpPanel">
        <div class="help-header">
            <h2>Help</h2>
            <button class="help-close-btn" id="helpCloseBtn">×</button>
        </div>
        <div class="help-content">
            <h3>Getting Started</h3>
            <p>The EYESY Simulator runs Python visual scripts designed for the Critter & Guitari EYESY hardware synthesizer.</p>

            <h3>Loading a Mode</h3>
            <ol>
                <li>Select a mode from the dropdown menu</li>
                <li>Click "Load Mode" to load the script</li>
                <li>Click "Start" to begin rendering</li>
            </ol>

            <h3>Controls</h3>
            <p>Use the 5 knobs below the preview to control visual parameters. Each mode responds to knobs differently.</p>

            <h3>Audio</h3>
            <p>Many modes respond to audio input. Configure audio in the Audio section:</p>
            <ul>
                <li><strong>Silence</strong> - No audio input</li>
                <li><strong>Sine Wave</strong> - Pure tone at specified frequency</li>
                <li><strong>White Noise</strong> - Random noise</li>
                <li><strong>Beat/Kick</strong> - Rhythmic beat pattern</li>
                <li><strong>Audio File</strong> - Upload your own audio</li>
                <li><strong>Internet Radio</strong> - Stream from online stations</li>
            </ul>

            <h3>Custom Modes</h3>
            <p>You can load your own Python scripts using "Browse main.py". Scripts should follow the EYESY mode format with <code>setup()</code> and <code>draw()</code> functions.</p>

            <h3>Keyboard Shortcuts</h3>
            <ul>
                <li><strong>Esc</strong> - Close this help panel</li>
            </ul>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>